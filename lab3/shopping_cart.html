<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Intelligent Shopping Cart</title>
    <style>
      :root {
        --primary: #ff6b6b;
        --secondary: #4ecdc4;
        --dark: #2f3640;
        --light: #f7f1e3;
        --white: #ffffff;
      }

      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background-color: var(--light);
        color: var(--dark);
        margin: 0;
        padding: 0;
      }

      header {
        background-color: var(--dark);
        color: var(--white);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .main-container {
        display: flex;
        padding: 2rem;
        gap: 2rem;
        max-width: 1200px;
        margin: 0 auto;
      }

      .products-section {
        flex: 2;
      }

      .cart-section {
        flex: 1;
        background: var(--white);
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        height: fit-content;
        position: sticky;
        top: 2rem;
      }

      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1.5rem;
      }

      .product-card {
        background: var(--white);
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        transition: transform 0.2s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .product-card:hover {
        transform: translateY(-5px);
      }

      .product-price {
        font-size: 1.2rem;
        color: var(--primary);
        font-weight: bold;
        margin: 10px 0;
      }

      .btn-add {
        background-color: var(--secondary);
        color: var(--white);
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
      }

      .btn-add:hover {
        opacity: 0.9;
      }

      .cart-items {
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: 1rem;
        border-bottom: 2px solid #eee;
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px dashed #eee;
      }

      .cart-item-controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-qty {
        background: #ddd;
        border: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        cursor: pointer;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }

      .summary-row.total {
        font-size: 1.4rem;
        font-weight: bold;
        margin-top: 1rem;
      }

      .discount {
        color: var(--primary);
      }

      .coupon-area {
        margin-top: 1.5rem;
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
      }

      #coupon-input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      #apply-coupon {
        background: var(--dark);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
      }

      #coupon-msg {
        width: 100%;
        font-size: 0.8rem;
        margin-top: 5px;
      }

      #checkout-btn {
        width: 100%;
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px;
        font-size: 1.1rem;
        border-radius: 6px;
        margin-top: 1rem;
        cursor: pointer;
      }

      .tag {
        background: #ffeaa7;
        font-size: 0.75rem;
        padding: 2px 5px;
        border-radius: 3px;
        margin-right: 3px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Smart Shop</h1>
      <div id="time-info"></div>
    </header>
    <div class="main-container">
      <div class="products-section">
        <h2>Products</h2>
        <div id="product-list" class="product-grid">
          <!-- Products injected by JS -->
        </div>
      </div>
      <div class="cart-section">
        <h2>Your Cart</h2>
        <div id="cart-items" class="cart-items">
          <p class="empty-msg">Cart is empty</p>
        </div>

        <div class="cart-summary">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          <div class="summary-row discount">
            <span>Discounts:</span>
            <span id="discount-amount">-$0.00</span>
          </div>
          <div class="summary-row" id="active-discounts">
            <!-- Active discount tags -->
          </div>
          <div class="summary-row total">
            <span>Total:</span>
            <span id="total">$0.00</span>
          </div>

          <div class="coupon-area">
            <input
              type="text"
              id="coupon-input"
              placeholder="Enter coupon (e.g. SAVE10)"
            />
            <button id="apply-coupon">Apply</button>
            <p id="coupon-msg"></p>
          </div>

          <button id="checkout-btn">Checkout</button>
        </div>
      </div>
    </div>
    <script>
      const products = [
        {
          id: 1,
          name: "Wireless Headphones",
          price: 99.99,
          category: "electronics",
        },
        { id: 2, name: "Smart Watch", price: 149.5, category: "electronics" },
        { id: 3, name: "Running Shoes", price: 79.0, category: "fashion" },
        { id: 4, name: "Cotton T-Shirt", price: 19.99, category: "fashion" },
        {
          id: 5,
          name: "Laptop Backpack",
          price: 45.0,
          category: "accessories",
        },
        {
          id: 6,
          name: "Mechanical Keyboard",
          price: 120.0,
          category: "electronics",
        },
      ];

      let cart = [];
      let appliedCoupon = null;

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        renderProducts();
        updateTime();
        setInterval(updateTime, 60000); // Check time every minute for time-based discounts
      });

      function updateTime() {
        const now = new Date();
        document.getElementById("time-info").textContent =
          now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
        updateCartDisplay(); // Re-calc discounts that might depend on time
      }

      function renderProducts() {
        const container = document.getElementById("product-list");
        container.innerHTML = products
          .map(
            (p) => `
              <div class="product-card">
                  <h3>${p.name}</h3>
                  <p class="product-sku">Cat: ${p.category}</p>
                  <div class="product-price">$${p.price.toFixed(2)}</div>
                  <button class="btn-add" onclick="addToCart(${p.id})">Add to Cart</button>
              </div>
          `,
          )
          .join("");
      }

      function addToCart(productId) {
        const existing = cart.find((item) => item.id === productId);
        if (existing) {
          existing.quantity++;
        } else {
          const product = products.find((p) => p.id === productId);
          cart.push({ ...product, quantity: 1 });
        }
        updateCartDisplay();
      }

      function removeFromCart(productId) {
        cart = cart.filter((item) => item.id !== productId);
        updateCartDisplay();
      }

      function updateQuantity(productId, change) {
        const item = cart.find((item) => item.id === productId);
        if (item) {
          item.quantity += change;
          if (item.quantity <= 0) {
            removeFromCart(productId);
          } else {
            updateCartDisplay();
          }
        }
      }

      function calculateTotals() {
        let subtotal = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0,
        );
        let discounts = [];
        let discountAmount = 0;

        // Rule 1: Bulk Discount (If total items > 5, 10% off)
        const totalItems = cart.reduce(
          (count, item) => count + item.quantity,
          0,
        );
        if (totalItems >= 5) {
          const bulkDisc = subtotal * 0.1;
          discountAmount += bulkDisc;
          discounts.push("Bulk (10%)");
        }

        // Rule 2: Category Discount (If electronics total > $200, $20 off)
        const electronicsTotal = cart
          .filter((item) => item.category === "electronics")
          .reduce((sum, item) => sum + item.price * item.quantity, 0);

        if (electronicsTotal > 200) {
          discountAmount += 20;
          discounts.push("Tech Deal ($20)");
        }

        // Rule 3: Time-based (Happy Hour 2PM-4PM gives 5% extra off)
        const hour = new Date().getHours();
        if (hour >= 14 && hour < 16) {
          const timeDisc = subtotal * 0.05;
          discountAmount += timeDisc;
          discounts.push("Happy Hour (5%)");
        }

        // Rule 4: Coupons
        // Accepted coupons: SAVE10 (10% off), FREESHIP (no effect on price here but valid)
        if (appliedCoupon === "SAVE10") {
          const couponDisc = subtotal * 0.1;
          discountAmount += couponDisc;
          discounts.push("Coupon SAVE10");
        }

        let total = subtotal - discountAmount;
        if (total < 0) total = 0;

        return { subtotal, discountAmount, total, discounts };
      }

      function updateCartDisplay() {
        const cartContainer = document.getElementById("cart-items");

        if (cart.length === 0) {
          cartContainer.innerHTML = '<p class="empty-msg">Cart is empty</p>';
        } else {
          cartContainer.innerHTML = cart
            .map(
              (item) => `
                  <div class="cart-item">
                      <div>
                          <h4>${item.name}</h4>
                          <p>$${item.price}</p>
                      </div>
                      <div class="cart-item-controls">
                          <button class="btn-qty" onclick="updateQuantity(${item.id}, -1)">-</button>
                          <span>${item.quantity}</span>
                          <button class="btn-qty" onclick="updateQuantity(${item.id}, 1)">+</button>
                      </div>
                  </div>
              `,
            )
            .join("");
        }

        const { subtotal, discountAmount, total, discounts } =
          calculateTotals();

        document.getElementById("subtotal").textContent =
          `$${subtotal.toFixed(2)}`;
        document.getElementById("discount-amount").textContent =
          `-$${discountAmount.toFixed(2)}`;
        document.getElementById("total").textContent = `$${total.toFixed(2)}`;

        const activeDiscounts = document.getElementById("active-discounts");
        activeDiscounts.innerHTML = discounts
          .map((d) => `<span class="tag">${d}</span>`)
          .join("");
      }

      // Global scope access needed for inline HTML events
      window.addToCart = addToCart;
      window.updateQuantity = updateQuantity;

      // Coupon logic
      document.getElementById("apply-coupon").addEventListener("click", () => {
        const code = document
          .getElementById("coupon-input")
          .value.toUpperCase()
          .trim();
        const msg = document.getElementById("coupon-msg");

        if (code === "SAVE10") {
          appliedCoupon = "SAVE10";
          msg.textContent = "Coupon Applied: SAVE10";
          msg.style.color = "green";
        } else if (code === "FREESHIP") {
          appliedCoupon = "FREESHIP";
          msg.textContent = "Coupon Applied: Free Shipping";
          msg.style.color = "green";
        } else {
          appliedCoupon = null;
          msg.textContent = "Invalid Coupon";
          msg.style.color = "red";
        }
        updateCartDisplay();
      });
    </script>
  </body>
</html>
