<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Activity Monitor</title>
    <style>
      body {
        background-color: #1a1a1a;
        color: #e0e0e0;
        font-family: "Consolas", "Monaco", monospace;
        margin: 0;
        padding: 20px;
        height: 100vh;
        box-sizing: border-box;
      }

      .monitor-dashboard {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        height: 100%;
      }

      .interactive-area {
        background: #2d2d2d;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #404040;
      }

      .log-panel {
        background: #000;
        border-radius: 8px;
        border: 1px solid #00ff00; /* Retro terminal look */
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .log-header {
        background: #0f380f;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #00ff00;
      }

      .log-header h3 {
        margin: 0;
        color: #00ff00;
      }

      .log-container {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        font-size: 0.9rem;
      }

      .log-entry {
        margin-bottom: 4px;
        border-bottom: 1px solid #333;
        padding-bottom: 2px;
      }

      .log-time {
        color: #888;
        margin-right: 10px;
      }

      .log-type {
        color: #4facfe;
        font-weight: bold;
        width: 60px;
        display: inline-block;
      }

      .log-desc {
        color: #e0e0e0;
      }

      .test-btn {
        display: block;
        margin: 10px 0;
        padding: 10px 20px;
        background: #4a90e2;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
      }

      .test-btn.secondary {
        background: #ff6b6b;
      }

      .test-input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        background: #333;
        border: 1px solid #555;
        color: white;
      }

      .box {
        width: 100px;
        height: 100px;
        background: #e67e22;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .box:focus {
        outline: 2px solid white;
      }

      .controls button {
        background: #333;
        color: white;
        border: 1px solid #555;
        padding: 5px 10px;
        cursor: pointer;
      }

      .controls button:hover {
        background: #444;
      }

      .warning {
        color: #ff0000;
        font-weight: bold;
        background: black;
        padding: 2px 5px;
        border: 1px solid red;
        margin-right: 10px;
        animation: blink 1s infinite;
      }

      .hidden {
        display: none;
      }

      @keyframes blink {
        50% {
          opacity: 0;
        }
      }

      .stats {
        padding: 10px;
        border-top: 1px solid #333;
        display: flex;
        gap: 20px;
        color: #888;
      }
    </style>
  </head>
  <body>
    <div class="monitor-dashboard">
      <div class="interactive-area">
        <h2>Test Area</h2>
        <p>Interact with these elements to generate logs.</p>

        <button class="test-btn">Click Me</button>
        <button class="test-btn secondary">Or Me</button>

        <input
          type="text"
          placeholder="Type something here..."
          class="test-input"
        />

        <div class="box" tabindex="0">Focus on me!</div>
      </div>

      <div class="log-panel">
        <div class="log-header">
          <h3>Activity Log</h3>
          <div class="controls">
            <span id="warning-msg" class="warning hidden"
              >⚠️ High Activity Detected!</span
            >
            <button id="reset-btn">Clear</button>
            <button id="export-btn">Export</button>
          </div>
        </div>
        <div id="log-container" class="log-container">
          <!-- Logs appear here -->
        </div>
        <div class="stats">
          <span>Clicks: <b id="click-count">0</b></span>
          <span>Keys: <b id="key-count">0</b></span>
        </div>
      </div>
    </div>
    <script>
      let activityLog = [];
      let clickCount = 0;
      let keyCount = 0;
      let lastActivityTime = Date.now();
      const SUSPICIOUS_THRESHOLD_MS = 200; // Trigger warning if events are faster than this
      let rapidEventCount = 0;
      const RAPID_COUNT_LIMIT = 5;

      document.addEventListener("DOMContentLoaded", () => {
        const logContainer = document.getElementById("log-container");
        const warningMsg = document.getElementById("warning-msg");

        // --- Utils ---
        function addLog(type, details) {
          const now = new Date();
          const timestamp =
            now.toLocaleTimeString() + "." + now.getMilliseconds();

          const entry = { timestamp, type, details };
          activityLog.push(entry);

          // DOM Update
          const div = document.createElement("div");
          div.className = "log-entry";
          div.innerHTML = `<span class="log-time">[${timestamp}]</span> <span class="log-type">${type}</span> <span class="log-desc">${details}</span>`;
          logContainer.prepend(div); // Newest top

          checkSuspiciousActivity();
          updateStats(type);
        }

        function checkSuspiciousActivity() {
          const now = Date.now();
          const diff = now - lastActivityTime;
          lastActivityTime = now;

          if (diff < SUSPICIOUS_THRESHOLD_MS) {
            rapidEventCount++;
          } else {
            if (rapidEventCount > 0) rapidEventCount--;
          }

          if (rapidEventCount > RAPID_COUNT_LIMIT) {
            warningMsg.classList.remove("hidden");
            setTimeout(() => warningMsg.classList.add("hidden"), 2000);
          }
        }

        function updateStats(type) {
          if (type === "CLICK") {
            clickCount++;
            document.getElementById("click-count").textContent = clickCount;
          } else if (type === "KEY") {
            keyCount++;
            document.getElementById("key-count").textContent = keyCount;
          }
        }

        // --- Event Listeners ---

        // 1. Clicks (Capturing phase to catch everything)
        document.addEventListener(
          "click",
          (e) => {
            const target =
              e.target.tagName +
              (e.target.className ? "." + e.target.className : "");
            addLog(
              "CLICK",
              `Target: ${target} | X:${e.clientX}, Y:${e.clientY}`,
            );
          },
          true,
        );

        // 2. Key Presses
        document.addEventListener("keydown", (e) => {
          addLog("KEY", `Key: ${e.key} | Code: ${e.code}`);
        });

        // 3. Focus (Does not bubble, use capture or focusin)
        document.addEventListener("focusin", (e) => {
          const target =
            e.target.tagName +
            (e.target.className ? "." + e.target.className : "");
          addLog("FOCUS", `Element: ${target}`);
        });

        // --- Controls ---
        document.getElementById("reset-btn").addEventListener("click", (e) => {
          e.stopPropagation(); // Don't log this click
          activityLog = [];
          logContainer.innerHTML = "";
          clickCount = 0;
          keyCount = 0;
          document.getElementById("click-count").textContent = "0";
          document.getElementById("key-count").textContent = "0";
          addLog("SYS", "Log cleared");
        });

        document.getElementById("export-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          const text = activityLog
            .map((l) => `[${l.timestamp}] ${l.type}: ${l.details}`)
            .join("\n");

          // Simple download trigger
          const blob = new Blob([text], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "activity_log.txt";
          a.click();
          addLog("SYS", "Log exported");
        });
      });
    </script>
  </body>
</html>
